<?php$route = 'blog/';$app->get($route, function ()  use ($app){	$request = $app->request();	$_GET = $request->params();	if(isset($_GET['query'])){ $query = $_GET['query']; } else { $query = '';}	$ReturnObject = array();	if($query=='')		{		$Query = "SELECT * FROM blog WHERE name LIKE '%" . $query . "%'";		}	else		{		$Query = "SELECT * FROM blog";		}	$Query .= " ORDER BY name ASC";	$DatabaseResult = mysql_query($Query) or die('Query failed: ' . mysql_error());	while ($Database = mysql_fetch_assoc($DatabaseResult))		{		$name = $Database['name'];		$description = $Database['description'];		$url = $Database['url'];		$tags = $Database['tags'];		$slug = $Database['slug'];		$F = array();		$F['name'] = $name;		$F['description'] = $description;		$F['url'] = $url;		$F['tags'] = $tags;		$F['slug'] = $slug;		array_push($ReturnObject, $F);		}	$api->response()->header("Content-Type", "application/json");	echo stripslashes(format_json(json_encode($ReturnObject)));	});$route = 'blog/';$app->post($route, function ()  use ($app){	$request = $app->request();	$_GET = $request->params();	if(isset($_GET['name'])){ $name = $_GET['name']; } else { $name = '';}	if(isset($_GET['description'])){ $description = $_GET['description']; } else { $description = '';}	if(isset($_GET['url'])){ $url = $_GET['url']; } else { $url = '';}	if(isset($_GET['tags'])){ $tags = $_GET['tags']; } else { $tags = '';}	$slug = PrepareFileName($name);	$Query = "SELECT * FROM blog WHERE name = '" . $name . "'";	$Database = mysql_query($Query) or die('Query failed: ' . mysql_error());	if($Database && mysql_num_rows($Database))		{		$Link = mysql_fetch_assoc($Database);		$ReturnObject = array();		$ReturnObject['message'] = "Blog Already Exists!";		$ReturnObject['slug'] = $slug;		}	else		{		$query = "INSERT INTO blog(";		if(isset($name)){ $query .= $name . ","; }		if(isset($description)){ $query .= $description . ","; }		if(isset($url)){ $query .= $url . ","; }		if(isset($tags)){ $query .= $tags . ","; }		$query .= ") VALUES(";		if(isset($name)){ $query .= "'" . mysql_real_escape_string($name) . "',"; }		if(isset($description)){ $query .= "'" . mysql_real_escape_string($description) . "',"; }		if(isset($url)){ $query .= "'" . mysql_real_escape_string($url) . "',"; }		if(isset($tags)){ $query .= "'" . mysql_real_escape_string($tags) . "',"; }		$query .= ")";		mysql_query($query) or die('Query failed: ' . mysql_error());		$ReturnObject = array();		$ReturnObject['message'] = "Blog Added!";		$ReturnObject['slug'] = $slug;		}	$api->response()->header("Content-Type", "application/json");	echo stripslashes(format_json(json_encode($ReturnObject)));	});$route = 'blog/:slug';$app->get($route, function ($slug)  use ($app){	$request = $app->request();	$_GET = $request->params();	$ReturnObject = array();	$Query = "SELECT * FROM blog WHERE slug = '" . $slug . "'";	$DatabaseResult = mysql_query($Query) or die('Query failed: ' . mysql_error());	while ($Database = mysql_fetch_assoc($DatabaseResult))		{		$name = $Database['name'];		$description = $Database['description'];		$url = $Database['url'];		$tags = $Database['tags'];		$slug = $Database['slug'];		$F = array();		$F['name'] = $name;		$F['description'] = $description;		$F['url'] = $url;		$F['tags'] = $tags;		$F['slug'] = $slug;		array_push($ReturnObject, $F);		}	$api->response()->header("Content-Type", "application/json");	echo stripslashes(format_json(json_encode($ReturnObject)));	});$route = 'blog/:slug';$app->put($route, function ($slug)  use ($app){	$request = $app->request();	$_GET = $request->params();	if(isset($_GET['name'])){ $name = $_GET['name']; } else { $name = '';}	if(isset($_GET['description'])){ $description = $_GET['description']; } else { $description = '';}	if(isset($_GET['url'])){ $url = $_GET['url']; } else { $url = '';}	if(isset($_GET['tags'])){ $tags = $_GET['tags']; } else { $tags = '';}	$Query = "SELECT * FROM blog WHERE slug = '" . $slug . "'";	$Database = mysql_query($Query) or die('Query failed: ' . mysql_error());	if($Database && mysql_num_rows($Database))		{		$query = "UPDATE blog SET";		if(isset($slug))			{			$query .= "slug='" . mysql_real_escape_string($slug) . "'";			}		if(isset($name))			{			$query .= "name='" . mysql_real_escape_string($name) . "'";			}		if(isset($description))			{			$query .= "description='" . mysql_real_escape_string($description) . "'";			}		if(isset($url))			{			$query .= "url='" . mysql_real_escape_string($url) . "'";			}		if(isset($tags))			{			$query .= "tags='" . mysql_real_escape_string($tags) . "'";			}		$query .= " WHERE slug = '" . $slug . "'";		mysql_query($query) or die('Query failed: ' . mysql_error());		$ReturnObject = array();		$ReturnObject['message'] = "Blog Updated!";		$ReturnObject['slug'] = $slug;		}	$api->response()->header("Content-Type", "application/json");	echo stripslashes(format_json(json_encode($ReturnObject)));	});$route = 'blog/:slug';$app->delete($route, function ($slug)  use ($app){	$request = $app->request();	$_GET = $request->params();	$Query = "DELETE FROM blog WHERE slug = '" . $slug . "'";	mysql_query($Query) or die('Query failed: ' . mysql_error());	$ReturnObject = array();	$ReturnObject['message'] = "Blog Deleted!";	$ReturnObject['slug'] = $slug;	$api->response()->header("Content-Type", "application/json");	echo stripslashes(format_json(json_encode($ReturnObject)));	});?>